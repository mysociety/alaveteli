<% @title = _("{{title}} - a Freedom of Information request to {{public_body}}",
              :title => h(@info_request.title),
              :public_body => (@info_request.public_body.name)) %>

<% if @info_request.prominence(:decorate => true).is_public? %>
  <% content_for :open_graph_tags do %>
    <meta property="article:published_time" content="<%= @info_request.created_at.iso8601 %>" />
    <meta property="article:modified_time" content="<%= @info_request.updated_at.iso8601 %>" />
    <meta property="og:description" content="<%= @info_request.initial_request_text %>" />
  <% end %>
<% end %>

<% if flash[:request_sent] %>
  <%= render :partial => 'request_sent',
             :locals => { :info_request => @info_request } %>
<% end %>

<%= render :partial => 'ga_events' %>

<% if @info_request.prominence(:decorate => true).is_hidden? %>
  <p id="hidden_request">
    <%= _("This request has prominence 'hidden'. You can only see it because " \
          "you are logged in as a super user.") %>
  </p>
<% end %>

<% if @info_request.prominence(:decorate => true).is_requester_only? %>
  <p id="hidden_request">
    <%= _("This request is hidden, so that only you the requester can see it. " \
          "Please <a href=\"{{url}}\">contact us</a> if you are not sure why.",
          :url => help_requesting_path.html_safe) %>
  </p>
<% end %>


<% if ( @update_status || @info_request.awaiting_description ) && ! @info_request.is_external? %>
  <div class="describe_state_form box" id="describe_state_form_1">
    <%= render :partial => 'describe_state', :locals => { :id_suffix => "1" } %>
  </div>
<% end %>

<div class="request-header">
  <div class="row">

    <h1><%=h(@info_request.title)%></h1>

    <div class="request-header__action-bar-container">
      <div class="request-header__action-bar">
        <% if !@info_request.is_external? && @info_request.user.profile_photo && !@render_to_file %>
          <div class=" request-header__profile-photo user_photo_on_request">
            <img src="<%= get_profile_photo_url(:url_name => @info_request.user.url_name) %>" alt="">
          </div>
        <% end %>
        <p class="request-header__subtitle <% if !@info_request.is_external? && @info_request.user.profile_photo && !@render_to_file %>request-header__subtitle--narrow<% end %>">
          <% if !@user.nil? && @user.admin_page_links? %>
            <%= _('{{user}} ({{user_admin_link}}) made this {{law_used_full}} request (<a href="{{request_admin_url}}">admin</a>) to {{public_body_link}} (<a href="{{public_body_admin_url}}">admin</a>)',
                  :user => request_user_link(@info_request, _('An anonymous user')),
                  :law_used_full => h(@info_request.law_used_human(:full)),
                  :user_admin_link => user_admin_link_for_request(
                    @info_request, _('external'), _('admin')),
                  :request_admin_url => admin_request_url(@info_request),
                  :public_body_link => public_body_link(@info_request.public_body),
                  :public_body_admin_url => admin_body_url(@info_request.public_body)) %>
          <% else %>
            <%= _('{{user}} made this {{law_used_full}} request',
                  :user=>request_user_link(@info_request, _('An anonymous user')),
                  :law_used_full=>h(@info_request.law_used_human(:full))) %>
            <%= _('to {{public_body}}',:public_body=>public_body_link(@info_request.public_body)) %>
          <% end %>
        </p>
        <% unless @render_to_file %>
          <div class="request-header__action-bar__actions <% if !@info_request.is_external? && @info_request.user.profile_photo && !@render_to_file %>request-header__action-bar__actions--narrow<% end %>">
            <%= render :partial => 'after_actions' %>
            <%= render :partial => 'track/tracking_links_simple', :locals => { :track_thing => @track_thing, :own_request => @info_request.user && @info_request.user == @user, :location => 'toolbar ' } %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="request-status">
      <p id="request_status" class="request-status-message request_icon_line icon_<%= @info_request.calculate_status %>">
        <%= render :partial => 'request_status' %>
      </p>
    </div>
  </div>
</div>

<div id="left_column" class="left_column">

  <% for info_request_event in @info_request_events %>
    <% if info_request_event.visible %>
      <%= render :partial => 'correspondence', :locals => { :info_request_event => info_request_event } %>
    <% end %>
  <% end %>

  <% if @info_request.awaiting_description && ! @info_request.is_external? %>
    <div class="describe_state_form box" id="describe_state_form_2">
      <%= render :partial => 'describe_state', :locals => { :id_suffix => "2" } %>
    </div>
  <% end %>

  <% unless @render_to_file %>
    <div class="request-footer__action-bar-container">
      <div class="request-footer__action-bar__actions">
        <%= render :partial => 'after_actions' %>
        <%= render :partial => 'track/tracking_links_simple',
                   :locals => { :track_thing => @track_thing,
                                :own_request => @info_request.user && @info_request.user == @user,
                                :location => 'toolbar' } %>
      </div>
    </div>
  <% end %>

</div>

<%- if @sidebar %><%= render :partial => 'sidebar' %><% end %>

<%= content_for :javascript do %>
  <%= javascript_include_tag 'request-attachments.js' %>
<% end %>